<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vanity Menu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: transparent;
            overflow: hidden;
            user-select: none;
        }

        #menu-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 450px;
            height: 650px;
            background: rgba(15, 15, 20, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        /* Header avec banner */
        #menu-header {
            height: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        #menu-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z"/></svg>') center/cover;
            opacity: 0.3;
        }

        #menu-title {
            font-size: 48px;
            font-weight: 700;
            color: white;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            letter-spacing: 2px;
            z-index: 1;
        }

        /* Category bar */
        #category-bar {
            height: 50px;
            background: rgba(20, 20, 28, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        #category-name {
            font-size: 18px;
            color: #a0a0b0;
            font-weight: 600;
            letter-spacing: 1px;
        }

        /* Options container */
        #options-container {
            height: 430px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(25, 25, 35, 0.8);
        }

        #options-container::-webkit-scrollbar {
            width: 8px;
        }

        #options-container::-webkit-scrollbar-track {
            background: rgba(40, 40, 50, 0.5);
            border-radius: 4px;
        }

        #options-container::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.6);
            border-radius: 4px;
        }

        #options-container::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.8);
        }

        /* Option item */
        .option-item {
            background: rgba(35, 35, 45, 0.6);
            margin-bottom: 8px;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
        }

        .option-item:hover {
            background: rgba(45, 45, 60, 0.8);
            transform: translateX(5px);
        }

        .option-item.selected {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border: 2px solid rgba(102, 126, 234, 0.6);
            transform: translateX(8px);
        }

        .option-label {
            font-size: 16px;
            color: #e0e0e0;
            font-weight: 500;
        }

        .option-value {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-arrow {
            color: #667eea;
            font-size: 18px;
        }

        /* Toggle switch */
        .toggle-switch {
            width: 50px;
            height: 26px;
            background: rgba(60, 60, 70, 0.8);
            border-radius: 13px;
            position: relative;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .toggle-slider {
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            left: 26px;
        }

        /* Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-bar {
            width: 100px;
            height: 6px;
            background: rgba(60, 60, 70, 0.8);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        .slider-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            transition: width 0.2s;
        }

        .slider-value {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            min-width: 50px;
            text-align: right;
        }

        /* Footer */
        #menu-footer {
            height: 50px;
            background: rgba(20, 20, 28, 0.9);
            display: flex;
            align-items: center;
            justify-content: space-around;
            border-top: 2px solid rgba(102, 126, 234, 0.3);
            padding: 0 20px;
        }

        .footer-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #a0a0b0;
            font-size: 13px;
        }

        .footer-key {
            background: rgba(102, 126, 234, 0.3);
            padding: 4px 10px;
            border-radius: 6px;
            color: #667eea;
            font-weight: 600;
            font-size: 12px;
        }

        /* Notification */
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            font-size: 14px;
            font-weight: 500;
        }

        #notification.show {
            transform: translateX(0);
        }

        /* Theme colors */
        .theme-rouge #menu-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .theme-bleu #menu-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .theme-violet #menu-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div id="menu-container" class="theme-violet">
        <!-- Header -->
        <div id="menu-header">
            <div id="menu-title">Vanity</div>
        </div>

        <!-- Category bar -->
        <div id="category-bar">
            <div id="category-name">Main menu</div>
        </div>

        <!-- Options -->
        <div id="options-container" id="options-list">
            <!-- Options will be dynamically added here -->
        </div>

        <!-- Footer -->
        <div id="menu-footer">
            <div class="footer-hint">
                <span class="footer-key">↑↓</span>
                <span>Navigate</span>
            </div>
            <div class="footer-hint">
                <span class="footer-key">ENTER</span>
                <span>Select</span>
            </div>
            <div class="footer-hint">
                <span class="footer-key">BACKSPACE</span>
                <span>Back</span>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification"></div>

    <script>
        let menuData = [];
        let currentCategory = "Main menu";
        let selectedIndex = 0;
        let menuOpen = false;

        // Listen for messages from Lua
        window.addEventListener('message', function(event) {
            const data = event.data;

            if (data.action === 'openMenu') {
                openMenu();
            } else if (data.action === 'closeMenu') {
                closeMenu();
            } else if (data.action === 'updateMenu') {
                menuData = data.categories;
                currentCategory = data.currentCategory || "Main menu";
                selectedIndex = data.selectedIndex || 0;
                renderMenu();
            } else if (data.action === 'notify') {
                showNotification(data.message);
            } else if (data.action === 'setTheme') {
                setTheme(data.theme);
            }
        });

        // Open menu
        function openMenu() {
            menuOpen = true;
            document.getElementById('menu-container').style.display = 'block';
        }

        // Close menu
        function closeMenu() {
            menuOpen = false;
            document.getElementById('menu-container').style.display = 'none';
        }

        // Render menu
        function renderMenu() {
            const container = document.getElementById('options-container');
            const categoryName = document.getElementById('category-name');
            
            categoryName.textContent = currentCategory;
            container.innerHTML = '';

            const category = menuData.find(cat => cat.label === currentCategory);
            if (!category) return;

            category.options.forEach((option, index) => {
                const item = document.createElement('div');
                item.className = 'option-item';
                if (index === selectedIndex) {
                    item.classList.add('selected');
                }

                const label = document.createElement('div');
                label.className = 'option-label';
                label.textContent = option.label;

                const value = document.createElement('div');
                value.className = 'option-value';

                if (option.type === 'toggle') {
                    const toggle = document.createElement('div');
                    toggle.className = 'toggle-switch' + (option.value ? ' active' : '');
                    const slider = document.createElement('div');
                    slider.className = 'toggle-slider';
                    toggle.appendChild(slider);
                    value.appendChild(toggle);
                } else if (option.type === 'slider') {
                    const sliderContainer = document.createElement('div');
                    sliderContainer.className = 'slider-container';
                    
                    const sliderBar = document.createElement('div');
                    sliderBar.className = 'slider-bar';
                    const sliderFill = document.createElement('div');
                    sliderFill.className = 'slider-fill';
                    const percent = ((option.value - option.min) / (option.max - option.min)) * 100;
                    sliderFill.style.width = percent + '%';
                    sliderBar.appendChild(sliderFill);
                    
                    const sliderValue = document.createElement('div');
                    sliderValue.className = 'slider-value';
                    sliderValue.textContent = option.value;
                    
                    sliderContainer.appendChild(sliderBar);
                    sliderContainer.appendChild(sliderValue);
                    value.appendChild(sliderContainer);
                } else if (option.type === 'action' || option.category) {
                    const arrow = document.createElement('span');
                    arrow.className = 'option-arrow';
                    arrow.textContent = '›';
                    value.appendChild(arrow);
                }

                item.appendChild(label);
                item.appendChild(value);
                container.appendChild(item);

                item.addEventListener('click', () => {
                    selectOption(index);
                });
            });

            // Scroll to selected item
            const selectedItem = container.children[selectedIndex];
            if (selectedItem) {
                selectedItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Select option
        function selectOption(index) {
            fetch(`https://${GetParentResourceName()}/selectOption`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ index: index })
            });
        }

        // Navigate up
        function navigateUp() {
            fetch(`https://${GetParentResourceName()}/navigateUp`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
        }

        // Navigate down
        function navigateDown() {
            fetch(`https://${GetParentResourceName()}/navigateDown`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
        }

        // Go back
        function goBack() {
            fetch(`https://${GetParentResourceName()}/goBack`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
        }

        // Close from JS
        function closeFromJS() {
            fetch(`https://${GetParentResourceName()}/closeMenu`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
        }

        // Show notification
        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => {
                notif.classList.remove('show');
            }, 3000);
        }

        // Set theme
        function setTheme(theme) {
            const container = document.getElementById('menu-container');
            container.className = 'theme-' + theme.toLowerCase();
        }

        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            if (!menuOpen) return;

            if (e.key === 'ArrowUp') {
                e.preventDefault();
                navigateUp();
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                navigateDown();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                selectOption(selectedIndex);
            } else if (e.key === 'Backspace' || e.key === 'Escape') {
                e.preventDefault();
                goBack();
            }
        });

        // Get resource name
        function GetParentResourceName() {
            let resourceName = 'vanity-menu';
            if (window.location.href.includes('://')) {
                const segments = window.location.href.split('/');
                resourceName = segments[segments.length - 2];
            }
            return resourceName;
        }
    </script>
</body>
</html>